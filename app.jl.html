<q-layout view="hHh lpR fFf" :class="theme">
    <q-header elevated class="bg-primary text-white">
        <q-toolbar>
            <q-toolbar-title>Investment Calculator</q-toolbar-title>
            <q-btn flat round :icon="darkmode ? 'light_mode' : 'dark_mode'" @click="darkmode = !darkmode"/>
        </q-toolbar>
    </q-header>

    <q-page-container>
        <div class="container q-pa-md">
            <header>
                <h4>Investment Calculator</h4>
            </header>
            <div class="row q-pa-md">
                <div class="col-12">
                    <h4>Project Parameters</h4>
                </div>
                <div class="col-md-4 q-pa-sm">
                    <q-input 
                        v-model.number="land_cost" 
                        type="number" 
                        label="Land Cost" 
                        filled 
                    />
                </div>
                <div class="col-md-4 q-pa-sm">
                    <q-input 
                        v-model.number="num_rooms" 
                        type="number" 
                        label="Number of Rooms" 
                        filled 
                    />
                </div>
                <div class="col-md-4 q-pa-sm">
                    <q-input 
                        v-model.number="nightly_rate" 
                        type="number" 
                        label="Nightly Rate" 
                        filled 
                    />
                </div>
                <div class="col-md-4 q-pa-sm">
                    <q-input 
                        v-model.number="occupancy_rate" 
                        type="number" 
                        label="Occupancy Rate (0-1)" 
                        filled 
                    />
                </div>
                <div class="col-md-4 q-pa-sm">
                    <q-input 
                        v-model.number="monthly_operating_costs" 
                        type="number" 
                        label="Monthly Operating Costs" 
                        filled 
                    />
                </div>
            </div>

            <div class="row q-pa-md">
                <div class="col-12">
                    <h4>Investment Structure</h4>
                </div>
                <div class="col-md-12 q-pa-sm">
                    <q-card>
                        <q-card-section>
                            <div class="row q-mb-md items-end">
                                <div class="col-md-4 q-px-sm">
                                    <q-input 
                                        v-model="new_investor_name" 
                                        label="Investor Name" 
                                        filled 
                                    />
                                </div>
                                <div class="col-md-4 q-px-sm">
                                    <q-input 
                                        v-model.number="new_investor_amount" 
                                        type="number" 
                                        label="Investment Amount" 
                                        filled 
                                    />
                                </div>
                                <div class="col-md-4 q-px-sm">
                                    <q-btn color="primary" v-on:click="add_investor = true" :loading="add_investor">Add Investor</q-btn>
                                </div>
                            </div>

                            <q-table
                                :rows="investors"
                                :columns="[
                                    {name: 'name', label: 'Name', field: 'name', align: 'left'},
                                    {name: 'amount', label: 'Amount', field: 'amount', format: val => val.toLocaleString('en-US', {style: 'currency', currency: 'USD'}), align: 'right'},
                                    {name: 'actions', label: 'Actions', align: 'center'}
                                ]"
                                row-key="name"
                                flat
                                bordered
                            >
                                <template v-slot:body="props">
                                    <q-tr :props="props">
                                        <q-td key="name" :props="props">{{ props.row.name }}</q-td>
                                        <q-td key="amount" :props="props">{{ props.row.amount.toLocaleString('en-US', {style: 'currency', currency: 'USD'}) }}</q-td>
                                        <q-td key="actions" :props="props">
                                            <q-btn size="sm" color="negative" round icon="delete" v-on:click="remove_investor = true" :loading="remove_investor" />
                                        </q-td>
                                    </q-tr>
                                </template>
                            </q-table>
                        </q-card-section>
                    </q-card>
                </div>
                <div class="col-md-12 q-pa-sm">
                    <q-card>
                        <q-card-section>
                            <plotly 
                                :data="investment_plot" 
                                :layout="investment_layout"
                                style="width:100%;height:300px"
                            />
                        </q-card-section>
                    </q-card>
                </div>
            </div>

            <div class="row q-pa-md">
                <div class="col-12">
                    <h4>Financial Overview</h4>
                </div>
                <div class="col-md-4 q-pa-sm">
                    <q-card>
                        <q-card-section>
                            <div class="text-h6">Monthly Revenue</div>
                            <div class="text-h4">{{monthly_revenue.toLocaleString('en-US', {style: 'currency', currency: 'USD'})}}</div>
                        </q-card-section>
                    </q-card>
                </div>
                <div class="col-md-8 q-pa-sm">
                    <q-card>
                        <q-card-section>
                            <div class="text-h6">Monthly Profit Distribution</div>
                            <div class="text-h4">{{monthly_profit.toLocaleString('en-US', {style: 'currency', currency: 'USD'})}}</div>
                            <div class="row">
                                <template v-for="investor in investors">
                                    <div class="col-md-6 q-pa-sm">
                                        <q-card>
                                            <q-card-section>
                                                <div class="text-h6">{{ investor.name }}</div>
                                                <div class="row">
                                                    <div class="col-6">
                                                        <div class="text-subtitle2">Equity Share</div>
                                                        <div class="text-h5">{{ (investor.equity || 0).toFixed(1) }}%</div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="text-subtitle2">Monthly Profit</div>
                                                        <div class="text-h5">{{ (investor.monthly_profit || 0).toLocaleString('en-US', {style: 'currency', currency: 'USD'}) }}</div>
                                                    </div>
                                                </div>
                                                <div class="text-subtitle2 q-mt-md">Break-even Time</div>
                                                <div class="text-h5">
                                                    {{ investor.breakeven_years }} years, 
                                                    {{ investor.breakeven_months }} months, 
                                                    {{ investor.breakeven_days }} days
                                                </div>
                                            </q-card-section>
                                        </q-card>
                                    </div>
                                </template>
                            </div>
                        </q-card-section>
                    </q-card>
                </div>
            </div>

            <div class="row q-pa-md">
                <div class="col-12">
                    <h4>Monthly Financial Breakdown</h4>
                </div>
                <div class="col-md-12 q-pa-sm">
                    <q-card>
                        <q-card-section>
                            <plotly
                                :data="[{
                                    x: financial_labels,
                                    y: financial_values,
                                    type: 'bar',
                                    marker: {
                                        color: financial_colors
                                    },
                                    text: financial_values.map(v => v.toLocaleString('en-US', {
                                        style: 'currency',
                                        currency: 'USD'
                                    })),
                                    textposition: 'auto'
                                }]"
                                :layout="{
                                    title: 'Monthly Financial Metrics',
                                    yaxis: { 
                                        title: 'Amount',
                                        showgrid: true
                                    },
                                    height: 400,
                                    bargap: 0.3
                                }"
                            />
                        </q-card-section>
                    </q-card>
                </div>
            </div>

            <div class="row q-pa-md">
                <div class="col-12">
                    <h4>Property Value Projections</h4>
                </div>
                <div class="col-md-3 q-pa-sm">
                    <q-input 
                        v-model.number="annual_appreciation" 
                        type="number" 
                        label="Annual Appreciation Rate (%)" 
                        filled 
                    />
                </div>
                <div class="col-md-9 q-pa-sm">
                    <q-card>
                        <q-card-section>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="text-subtitle1">Year 1</div>
                                    <div class="text-h6">{{year1_value.toLocaleString('en-US', {style: 'currency', currency: 'USD'})}}</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-subtitle1">Year 3</div>
                                    <div class="text-h6">{{year3_value.toLocaleString('en-US', {style: 'currency', currency: 'USD'})}}</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-subtitle1">Year 5</div>
                                    <div class="text-h6">{{year5_value.toLocaleString('en-US', {style: 'currency', currency: 'USD'})}}</div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-subtitle1">Year 10</div>
                                    <div class="text-h6">{{year10_value.toLocaleString('en-US', {style: 'currency', currency: 'USD'})}}</div>
                                </div>
                            </div>
                        </q-card-section>
                    </q-card>
                </div>
            </div>

            <div class="row q-pa-md">
                <div class="col-12">
                    <h4>Property Value Chart</h4>
                </div>
                <div class="col-md-12 q-pa-sm">
                    <q-card>
                        <q-card-section>
                            <plotly
                                :data="[{
                                    x: years,
                                    y: values,
                                    mode: 'lines+markers',
                                    type: 'scatter',
                                    name: 'Property Value',
                                    line: { color: 'rgb(61, 185, 100)', width: 2 },
                                    marker: { size: 8 }
                                }]"
                                :layout="{
                                    title: 'Property Value Over Time',
                                    xaxis: { title: 'Years', range: [0, 10] },
                                    yaxis: { title: 'Value' },
                                    height: 400
                                }"
                            />
                        </q-card-section>
                    </q-card>
                </div>
            </div>
        </div>
    </q-page-container>
</q-layout>
